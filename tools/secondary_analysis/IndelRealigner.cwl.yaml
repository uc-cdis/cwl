#!/usr/bin/env cwl-runner

cwlVersion: v1.0

class: CommandLineTool

requirements:
  - $import: ../envvar-global.cwl
  - class: InlineJavascriptRequirement
  - class: ShellCommandRequirement
  - class: MultipleInputFeatureRequirement
  - class: DockerRequirement
    dockerPull: registry.gitlab.com/uc-cdis/genomel-secondary-analysis:0.1b

inputs:
  - id: java_opts
    type: string
    default: "-Xmx8g"
    doc: |
      "JVM arguments should be a quoted, space separated list (e.g. -Xmx8g -Xmx16g -Xms128m -Xmx512m)"
    inputBinding:
      position: 1
      shellQuote: false
  - id: input_bam_path
    type: File
    doc: Input bam file
    inputBinding:
      position: 4
      prefix: "-I"
    secondaryFiles:
      - "^.bai"
  - id: reference_fasta_path
    type: File
    doc: Referene fasta with .dict and .fai
    inputBinding:
      position: 5
      prefix: "-R"
    secondaryFiles:
      - "^.dict"
      - ".fai"
  - id: reference_indel_path
    type: File
    doc: INDEL reference path
    inputBinding:
      position: 6
      prefix: "-known"
    secondaryFiles:
      - ".tbi"
  - id: reference_snp_path
    type: File
    doc: SNP reference path
    inputBinding:
      position: 7
      prefix: "-known"
    secondaryFiles:
      - ".tbi"
  - id: target_intervals
    type: File
    doc: Target intervals file
    inputBinding:
      position: 8
      prefix: "-targetIntervals"

outputs:
  - id: output_realigned_bam
    type: File
    outputBinding:
      glob: $(inputs.input_bam_path.nameroot + '.realigned.bam')
    secondaryFiles:
      - "^.bai"

baseCommand: java
arguments:
  - valueFrom: /home/ubuntu/tools/GenomeAnalysisTK.jar
    position: 2
    prefix: -jar
  - valueFrom: IndelRealigner
    position: 3
    prefix: -T
  - valueFrom: NotPrimaryAlignment
    position: 9
    prefix: -rf
  - valueFrom: $(inputs.input_bam_path.nameroot + '.realigned.bam')
    position: 10
    prefix: "-o"
  - valueFrom: "7"
    position: 11
    prefix: -compress
